<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, sans-serif;
      background: #1a1a2e;
      color: #eee;
      display: flex;
      justify-content: center;
      padding: 2rem 1rem;
    }

    .container { width: 100%; max-width: 400px; text-align: center; }

    #duracao {
      text-align: center;
      font-size: 3.5rem;
      width: 100%;
      padding: 0.5rem;
      border: none;
      border-radius: 1rem;
      background: #09AA9D;
      color: #fff;
      font-family: monospace;
    }

    #duracao::placeholder { color: rgba(255,255,255,0.5); }

    .info {
      margin: 1.2rem 0;
      font-size: 1.1rem;
      line-height: 1.8;
    }

    #voltas {
      width: 3.5rem;
      padding: 0.3rem;
      border: 1px solid #09AA9D;
      border-radius: 0.4rem;
      background: #16213e;
      color: #fff;
      font-size: 1.1rem;
      text-align: center;
    }

    #txtRpm {
      font-weight: bold;
      font-size: 1.3rem;
      color: #09AA9D;
    }

    .controls {
      margin-top: 1rem;
      display: flex;
      gap: 0.8rem;
      justify-content: center;
    }

    button {
      font-size: 1.2rem;
      padding: 0.7rem 1.8rem;
      border: none;
      border-radius: 0.7rem;
      cursor: pointer;
      color: #fff;
      background: #09AA9D;
    }

    button:active { opacity: 0.8; }

    .btn-parar { background: #e74c3c; }
    .btn-zerar { background: #e67e22; }
  </style>
</head>

<body>

  <div class="container">
    <input type="text" id="duracao" placeholder="00:00" maxlength="5">

    <div class="info">
      <input id="voltas" type="number" min="1" value="1"> volta(s) completa(s) em
      <span id="txtTempo">--:--</span> corresponde a
      <span id="txtRpm">--</span> RPM.
    </div>

    <div class="controls">
      <button id="btn">&#9654;&#65039; Iniciar</button>
    </div>
  </div>

  <script>
    const duracao = document.getElementById('duracao');
    const voltas = document.getElementById('voltas');
    const txtTempo = document.getElementById('txtTempo');
    const txtRpm = document.getElementById('txtRpm');
    const btn = document.getElementById('btn');

    let startTime = 0;
    let elapsedTime = 0;
    let timerInterval = null;
    // estados: 'iniciar', 'parar', 'zerar'
    let estado = 'iniciar';

    function formatTime(totalSeconds) {
      const min = Math.floor(totalSeconds / 60);
      const sec = Math.floor(totalSeconds % 60);
      return String(min).padStart(2, '0') + ':' + String(sec).padStart(2, '0');
    }

    function parseTime(str) {
      const parts = str.split(':');
      if (parts.length === 2) {
        return parseInt(parts[0], 10) * 60 + parseInt(parts[1], 10);
      }
      return 0;
    }

    function calcRpm(tempoSegundos, numVoltas) {
      if (tempoSegundos <= 0 || numVoltas <= 0) return '--';
      const tempoMinutos = tempoSegundos / 60;
      const rpm = numVoltas / tempoMinutos;
      return rpm.toFixed(2);
    }

    function updateDisplay() {
      const totalMs = Date.now() - startTime + elapsedTime;
      const totalSeconds = totalMs / 1000;
      duracao.value = formatTime(totalSeconds);
      const numVoltas = parseInt(voltas.value, 10) || 1;
      txtTempo.textContent = formatTime(totalSeconds);
      txtRpm.textContent = calcRpm(totalSeconds, numVoltas);
    }

    function updateFromManual() {
      if (estado === 'parar') return;
      const totalSeconds = parseTime(duracao.value);
      const numVoltas = parseInt(voltas.value, 10) || 1;
      if (totalSeconds > 0) {
        txtTempo.textContent = formatTime(totalSeconds);
        txtRpm.textContent = calcRpm(totalSeconds, numVoltas);
      } else {
        txtTempo.textContent = '--:--';
        txtRpm.textContent = '--';
      }
    }

    function setEstado(novoEstado) {
      estado = novoEstado;
      btn.className = '';
      if (estado === 'iniciar') {
        btn.textContent = '▶️ Iniciar';
      } else if (estado === 'parar') {
        btn.textContent = '⏹️ Parar';
        btn.className = 'btn-parar';
      } else if (estado === 'zerar') {
        btn.textContent = '↩️ Zerar';
        btn.className = 'btn-zerar';
      }
    }

    btn.addEventListener('click', function () {
      if (estado === 'iniciar') {
        startTime = Date.now();
        duracao.readOnly = true;
        timerInterval = setInterval(updateDisplay, 200);
        setEstado('parar');
      } else if (estado === 'parar') {
        clearInterval(timerInterval);
        elapsedTime += Date.now() - startTime;
        duracao.readOnly = false;
        setEstado('zerar');
      } else if (estado === 'zerar') {
        startTime = 0;
        elapsedTime = 0;
        duracao.value = '';
        duracao.readOnly = false;
        txtTempo.textContent = '--:--';
        txtRpm.textContent = '--';
        setEstado('iniciar');
      }
    });

    duracao.addEventListener('input', function (e) {
      if (estado === 'parar') return;
      let value = e.target.value.replace(/\D/g, '');
      let resultado = '';
      for (let i = 0; i < value.length && i < 4; i++) {
        let digito = value[i];
        if (i === 0 || i === 2) {
          if (digito > '5') continue;
        }
        resultado += digito;
        if (i === 1 && value.length > 2) resultado += ':';
      }
      e.target.value = resultado;
      updateFromManual();
      if (parseTime(resultado) > 0) {
        elapsedTime = parseTime(resultado) * 1000;
        setEstado('zerar');
      }
    });

    voltas.addEventListener('input', function () {
      if (estado !== 'parar') updateFromManual();
    });
  </script>

</body>

</html>
